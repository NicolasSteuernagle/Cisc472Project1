<!DOCTYPE html>
<head>
  <script defer src="https://code.jquery.com/jquery-3.6.0.min.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js"type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js"type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js"type="module"></script>
  <script type="module">import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js';
    const firebaseConfig = {
      apiKey: "AIzaSyC5iUJZmheJ3nqzWs9HfG1_Z3bSfBy6wHI",
      authDomain: "tournament-app-7e139.firebaseapp.com",
      databaseURL: "https://tournament-app-7e139-default-rtdb.firebaseio.com",
      projectId: "tournament-app-7e139",
      storageBucket: "tournament-app-7e139.appspot.com",
      messagingSenderId: "339177512212",
      appId: "1:339177512212:web:5dae58f786925fc0487601"
};
const app = initializeApp(firebaseConfig);
</script>
  <style>
    .topNav{
      background-color: black;
      overflow: hidden;
    }
    #viewTournamentPage {
      background-color: #f5f5f5;
      padding: 20px;
    }
    #createTournamentPage{
      background-color: #f5f5f5;
      padding: 20px;
    }
    #tourney-container {
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 20px;
      background-color: #fff;
    }
    .round {
      margin: 20px 0;
    }
    .match {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 10px 0;
      background-color: #ffffff;
    }
    .edit-button {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      display: block;
      margin: 0 auto;
      align-items: center;
    }
    .column {
      width: 40%;
      float: left;
      text-align: left;
      font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
      font-size: 15px;
      padding: 10px;
      background-color: whitesmoke;
    }    
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
      text-align: center;
    }

    input[type="text"],
    input[type = "email"],
    input[type = "password"],
    input[type="number"] {
      width: 50%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      display: block;
      margin: 0 auto;
      border-radius: 25px;
      align-items: center;
      text-align: center;
    }
    
  </style>
</head>
<html>
  <body style="background-color: whitesmoke">
    <div id = "topNav", class="topNav">
    <button style="border: none; color: white; 
    text-align: center; background-color: black; padding: 15px 32px; font-size: 20px; float: left;">Competition Companion</button>
    <button id="logoutButton" style="border: none; color: white; 
    text-align: center; background-color: black; padding: 15px 32px; font-size: 16px;float: right;">Logout</button>
    <button id="viewTournamentButton" style="border: none; color: white; 
    text-align: center; background-color: black; padding: 15px 32px; font-size: 16px;float: right;">View A Tournament</button>
    <button id="createTournamentButton" style="border: none; color: white; 
    text-align: center; background-color: black; padding: 15px 32px; font-size: 16px;float: right;">Create A Tournament</button>
    <button id="homeButton" style="border: none; color: white;     
    text-align: center; background-color: black; padding: 15px 32px; font-size: 16px; float: right;">Home</button>
    </div>
  <main>
    <section id = "homePage" style="display: none;">
      <p style="font-size: 30px; text-align: center;font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
      padding: 10px;background-color: whitesmoke;">What We Offer</p>
      <div class="row"></div>
      <div class="column"><p style="font-size: 30px;font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;background-color: whitesmoke;">Tournament Creator:</p>
      <p>
        Easily create your own tornaments!<br>
        Follow these simple steps to get your tournament up and running.
      <ol>
        <li>
          Click the "Create A Tournament" Tab.
        </li>
        <li>
          Enter your tournament information.
        </li>
        <li>
          Grab the link that we provide to view your tournament.
        </li>
      </ol>
      Just like that, you set up and can now manage a tournament!
    </p>
    </div>
    <img src="Example_Tourney.png" alt="An example tournament made with Competition Companion" 
    style="width: 550px;height: 350px;float: right; padding: 40px;width: 50%;background-color: whitesmoke;
    display: flex;justify-content: center;align-items: center;">
      <div class="column"><p style="font-size: 30px;font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;">Tournament Viewer:</p>
        <p>
        If you have an existing tournament or you want to view an existing tournament you can do that by following these steps! <br>
        <ol>
          <li>
            Enter the URL that was given to you when you created your tournament, or enter the URL provided by the tournament manager.
          </li>
          <li>
            Click on the "View A Tournament" tab.
          </li>
        </ol>
        You can now see the tournament. You can easily edit tournament information by entering infomation into the text boxes and clicking "Edit".<br>
        Now you're all set to compete through Competition Companion
        </p>
      </div>
    </section>
    <section id="createTournamentPage" style="display: none;">
      <h1 style="text-align: center;font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
      font-size: 30px;">Tournament Creator</h1>
      <form id="createTournamentForm">
        <label for="tournamentName">Tournament Name:</label>
        <input type="text" id="tournamentName" required><br>
        <label for= "tournamentDescription">Tournament Desrcription:</label>
        <input type = "text" id = "tournamentDescription" required><br>
        <label for="winner">Winner:</label>
        <input type="text" id="winner"><br>
        <label for="numPlayers">Number of Players:</label>
        <input type="number" id="numPlayers"><br>
        <button type="submit" style="background-color: #007bff;color: white;border: none;padding: 5px 10px;cursor: pointer;
        display: block;margin: 0 auto; align-items: center;">Create Tournament</button>
      </form>
    </section>
    <section id="viewTournamentPage" style="display: none;">
      <div id="tourney-container">
      </div>
    </section>
    <section id="loginPage" style="display: none;">
      <h1 style="text-align: center; font-size: 30px;">Competition Companion</h1>
      <h1 style="text-align: center;">Login</h1>
      <form id="loginForm">
        <label for="email">Email:</label>
        <input type="email" id="email" required><br>
        <label for="password">Password:</label>
        <input type="password" id="password" required><br>
        <button type="submit" style="background-color: #007bff;color: white;border: none;padding: 5px 10px;cursor: pointer;
        display: block;margin: 0 auto; align-items: center;">Sign In</button>
      </form>
      <h1 style="text-align: center;">Register</h1>
      <form id="registrationForm">
        <label for="regEmail">Email:</label>
        <input type="email" id="regEmail" required><br>
        <label for="regPassword">Password:</label>
        <input type="password" id="regPassword" required><br>
        <button type="submit" style="background-color: #007bff;color: white;border: none;padding: 5px 10px;cursor: pointer;
        display: block;margin: 0 auto; align-items: center;">Sign Up</button>
      </form>
    </section>
  </main>
  </body>
<script type="module">
    import { getAuth } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js';
    import { signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js';
    import { createUserWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.5.0/firebase-auth.js';
    const auth = getAuth();
    let tourney;
    const homeButton = document.getElementById("homeButton");
    const createButton = document.getElementById('createTournamentButton');
    const viewButton = document.getElementById('viewTournamentButton');
    const homePage = document.getElementById('homePage');
    const createPage = document.getElementById('createTournamentPage');
    const viewPage = document.getElementById('viewTournamentPage');
    const loginPage = document.getElementById('loginPage');
    const urlParams = new URLSearchParams(window.location.search);
    const urlname = urlParams.get("name");
    const urlid = urlParams.get("id");
    onAuthStateChanged(auth, (user) => {
    if (user) {      
      document.getElementById("topNav").style.display = "block";
      homePage.style.display = "block";
      loginPage.style.display = "none";
      homeButton.addEventListener('click', () => {
        homePage.style.display = 'block';
        createPage.style.display = 'none';
        viewPage.style.display = 'none';
        loginPage.style.display = 'none';
    });
    createButton.addEventListener('click', () => {
        homePage.style.display = 'none';
        createPage.style.display = 'block';
        viewPage.style.display = 'none';
        loginPage.style.display = 'none';
    });
    viewButton.addEventListener('click', () => {
        homePage.style.display = 'none';
        createPage.style.display = 'none';
        viewPage.style.display = 'block';
        loginPage.style.display = 'none';
    });
    const logoutButton = document.getElementById('logoutButton');
    logoutButton.addEventListener('click', () => {
     signOut(auth)
    .then(() => {
      location.reload();
      console.log("signed out")
      });
    });
    function renderTourney(tourney) {
      const container = document.getElementById("tourney-container");
      container.innerHTML = '';
      const nameElement = document.createElement("h2");
      nameElement.style.textAlign = "center";
      const descriptionElement = document.createElement("h3");
      descriptionElement.style.textAlign = "center";
      descriptionElement.style.fontWeight  = "normal";
      nameElement.textContent = tourney.name;
      container.appendChild(nameElement);
      descriptionElement.textContent = tourney.description;
      container.appendChild(descriptionElement);
      for (const round in tourney) {
        if (round === "winner" || round === "description" || round === "players" || round === "name") {
          continue;
        }
        const roundElement = document.createElement("div");
        roundElement.classList.add("round");
        roundElement.innerHTML = `<h2>Round ${round.substring(5)}</h2>`;
        container.appendChild(roundElement);
        for (const match in tourney[round]) {
          const matchData = tourney[round][match];
          const matchElement = document.createElement("div");
          matchElement.classList.add("match");
          matchElement.innerHTML = `
            <h3>Match ${match.substring(5)}</h3>
            <label for="player1-name">Player 1 Name:</label>
            <input type="text" id="player1-name" value="${matchData.player1.name}">
            <label for="player1-score">Player 1 Score:</label>
            <input type="number" id="player1-score" value="${matchData.player1.score}">
            <br>
            <label for="player2-name">Player 2 Name:</label>
            <input type="text" id="player2-name" value="${matchData.player2.name}">
            <label for="player2-score">Player 2 Score:</label>
            <input type="number" id="player2-score" value="${matchData.player2.score}">
            <button class="edit-button">Edit</button>
          `;
          const editButton = matchElement.querySelector(".edit-button");
          editButton.addEventListener('click', () => {
            matchData.player1.name = matchElement.querySelector('#player1-name').value;
            matchData.player1.score = parseInt(matchElement.querySelector('#player1-score').value);
            matchData.player2.name = matchElement.querySelector('#player2-name').value;
            matchData.player2.score = parseInt(matchElement.querySelector('#player2-score').value);
            const placeToPut = `https://tournament-app-7e139-default-rtdb.firebaseio.com/Tournaments/${urlname}/${urlid}.json`;
            $.ajax({
              method: "PUT",
              url: placeToPut,
              data: JSON.stringify(tourney),
              success: () =>{
                console.log("made it");
              }
            })
          });
          roundElement.appendChild(matchElement);
        }
      }
      const winnerElement = document.createElement("h1");
      winnerElement.style.textAlign = "center";
      winnerElement.textContent = "Winner: " + tourney.winner;
      container.appendChild(winnerElement);
    }     
    const createTournamentForm = document.getElementById('createTournamentForm');
    createTournamentForm.addEventListener('submit', function (e) {
    e.preventDefault();
    const tournamentName = document.getElementById('tournamentName').value;
    const tournamentDescription = document.getElementById('tournamentDescription').value;
    const winner = document.getElementById('winner').value;
    const numPlayers = parseInt(document.getElementById('numPlayers').value);
    const numMatches = Math.ceil(Math.log2(numPlayers));
    const newTournament = {
        name: tournamentName,
        description: tournamentDescription,
        players: numPlayers,
        winner: winner,
    };
    for (let round = 1; round <= numMatches; round++) {
        newTournament[`round${round}`] = {};
        for (let match = 1; match <= numPlayers / Math.pow(2, round); match++) {
            newTournament[`round${round}`][`match${match}`] = {
                player1: { name: 'Register-Here', score: 0 },
                player2: { name: 'Register-Here', score: 0 },
            };
        }
    }
     $.ajax({
        method: "POST",
        url: `https://tournament-app-7e139-default-rtdb.firebaseio.com/Tournaments/${tournamentName}.json`,
        data: JSON.stringify(newTournament),
        success: (data) => {
            const userUrl = `https://tournament-app-7e139.web.app/?name=${tournamentName}&id=${data.name}`;
            alert(userUrl);
    }}); 
});
    if (urlParams.has("name") && urlParams.has("id")){
      const url = `https://tournament-app-7e139-default-rtdb.firebaseio.com/Tournaments/${urlname}/${urlid}.json`;     
      fetch(url)
      .then(response => response.json())
      .then(data => {
        tourney = data;
        renderTourney(tourney, "#tourney-container");
      })
    } 
    } else {
      document.getElementById("topNav").style.display = "none";
      loginPage.style.display = 'block';
      const loginForm = document.getElementById('loginForm');
      const registrationForm = document.getElementById('registrationForm');
      loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          const user = userCredential.user;
        })
    });
    registrationForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const regEmail = document.getElementById('regEmail').value;
    const regPassword = document.getElementById('regPassword').value;
    createUserWithEmailAndPassword(auth, regEmail, regPassword)
      .then((userCredential) => {
        const user = userCredential.user;
        console.log('User registered:', user);
        })
    });
    }
  });
  </script>
</html>